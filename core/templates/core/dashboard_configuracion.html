{% extends 'core/base.html' %}

{% block content %}
<div class="p-8 bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen">
    <div class="mb-10 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-landmark mr-3 text-indigo-600"></i>
                Configuraci√≥n SUTRA (IA + H√≠brido)
            </h1>
            <p class="text-gray-500">Gestiona tu monitoreo legislativo usando el sistema h√≠brido (RRF, IA, palabras clave).</p>
        </div>
        <a href="{% url 'dashboard' %}" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md hover:shadow-lg transition-all duration-200">
            <i class="fas fa-tachometer-alt mr-2"></i> Ver Dashboard
        </a>
    </div>

    <!-- Asistente visual -->
    <div class="mb-8 bg-gradient-to-r from-indigo-100 to-purple-100 border-l-4 border-indigo-500 p-5 rounded-r-lg shadow-sm">
        <div class="flex items-start">
            <i class="fas fa-robot text-indigo-600 text-2xl mr-4 mt-1 animate-bounce"></i>
            <div>
                <h3 class="font-bold text-gray-800 mb-2">¬øC√≥mo funciona la configuraci√≥n?</h3>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>‚Ä¢ <strong>Monitorea medidas</strong> por n√∫mero y comisiones completas.</li>
                    <li>‚Ä¢ <strong>Elige m√©todo:</strong> H√≠brida (RRF), Sem√°ntica (IA) o Palabras Clave.</li>
                    <li>‚Ä¢ <strong>Filtra con palabras clave</strong> y ajusta sensibilidad (threshold).</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Medidas monitoreadas -->
        <div class="bg-white rounded-xl shadow-lg border border-indigo-200 p-8">
            <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                <i class="fas fa-file-alt text-indigo-600 mr-2 text-2xl"></i> Medidas Legislativas
            </h2>
            <form method="POST" action="{% url 'dashboard_configuracion' %}" class="space-y-4">
                {% csrf_token %}
                <input type="hidden" name="add_measure" value="1">
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">N√∫mero de medida</label>
                    <input type="text" name="measure_id" class="p-2 border-2 border-indigo-200 rounded-lg" required placeholder="Ej: P. de la C. 1234">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">Palabras clave (separadas por coma)</label>
                    <input type="text" name="measure_keywords" class="p-2 border-2 border-indigo-200 rounded-lg">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">Sensibilidad (threshold 0-100)</label>
                    <input type="number" name="measure_threshold" min="0" max="100" value="15" class="p-2 border-2 border-indigo-200 rounded-lg">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">M√©todo de b√∫squeda</label>
                    <select name="measure_search_method" class="p-2 border-2 border-indigo-200 rounded-lg">
                        <option value="hybrid">H√≠brida (RRF)</option>
                        <option value="semantic">Sem√°ntica (IA)</option>
                        <option value="keyword">Palabras Clave</option>
                    </select>
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all">Agregar Medida</button>
            </form>
            <div class="mt-8">
                <h3 class="font-semibold mb-2">Medidas Monitoreadas</h3>
                <ul class="space-y-2">
                    {% for measure in monitored_measures %}
                        <li class="flex items-center justify-between bg-indigo-50 border border-indigo-200 rounded-lg px-4 py-2">
                            <span class="font-mono">{{ measure.sutra_id }} ({{ measure.search_method|title }})</span>
                            <form method="post" action="{% url 'delete_item' 'measure' measure.id %}">{% csrf_token %}<button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></form>
                        </li>
                    {% empty %}
                        <li class="text-gray-400">No hay medidas monitoreadas.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Comisiones monitoreadas -->
        <div class="bg-white rounded-xl shadow-lg border border-purple-200 p-8">
            <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                <i class="fas fa-users text-purple-600 mr-2 text-2xl"></i> Comisiones Legislativas
            </h2>
            <form method="POST" action="{% url 'dashboard_configuracion' %}" class="space-y-4">
                {% csrf_token %}
                <input type="hidden" name="add_commission" value="1">
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">Nombre de la comisi√≥n</label>
                    <select name="commission_name" class="p-2 border-2 border-purple-200 rounded-lg">
                        {% for c in available_commissions %}
                            <option value="{{ c }}">{{ c }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">Palabras clave (separadas por coma)</label>
                    <input type="text" name="commission_keywords" class="p-2 border-2 border-purple-200 rounded-lg">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">Sensibilidad (threshold 0-100)</label>
                    <input type="number" name="commission_threshold" min="0" max="100" value="15" class="p-2 border-2 border-purple-200 rounded-lg">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-semibold">M√©todo de b√∫squeda</label>
                    <select name="commission_search_method" class="p-2 border-2 border-purple-200 rounded-lg">
                        <option value="hybrid">H√≠brida (RRF)</option>
                        <option value="semantic">Sem√°ntica (IA)</option>
                        <option value="keyword">Palabras Clave</option>
                    </select>
                </div>
                <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all">Agregar Comisi√≥n</button>
            </form>
            <div class="mt-8">
                <h3 class="font-semibold mb-2">Comisiones Monitoreadas</h3>
                <ul class="space-y-2">
                    {% for commission in monitored_commissions %}
                        <li class="flex items-center justify-between bg-purple-50 border border-purple-200 rounded-lg px-4 py-2">
                            <span class="font-mono">{{ commission.name }} ({{ commission.search_method|title }})</span>
                            <form method="post" action="{% url 'delete_item' 'commission' commission.id %}">{% csrf_token %}<button class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></form>
                        </li>
                    {% empty %}
                        <li class="text-gray-400">No hay comisiones monitoreadas.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
                               required>
                        <button type="submit" 
                                name="add_measure"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-6 py-3 rounded-lg transition-all shadow-md hover:shadow-lg whitespace-nowrap">
                            <i class="fas fa-plus mr-2"></i> Agregar
                        </button>
                    </div>
                    
                    <!-- Opciones avanzadas (colapsadas por defecto) -->
                    <details class="bg-white rounded-lg border border-indigo-200 overflow-hidden">
                        <summary class="cursor-pointer text-sm text-indigo-700 hover:bg-indigo-50 font-semibold p-3 select-none">
                            <i class="fas fa-cog mr-2"></i> Opciones Avanzadas (Opcional)
                        </summary>
                        <div class="p-4 space-y-4 bg-indigo-50/50">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-search mr-1 text-indigo-600"></i> Palabras Clave
                                </label>
                                <input type="text" 
                                       name="measure_keywords" 
                                       placeholder="educaci√≥n, presupuesto, reforma, salud..."
                                       class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500">
                                <p class="text-xs text-gray-500 mt-1">Filtra actualizaciones que contengan estos t√©rminos (separados por coma)</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-brain mr-1 text-indigo-600"></i> M√©todo de B√∫squeda
                                </label>
                                <select name="measure_search_method" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500">
                                    <option value="hybrid">üîÑ H√≠brida - Combina IA + Palabras (Recomendado)</option>
                                    <option value="semantic">üß† Sem√°ntica - Solo Inteligencia Artificial</option>
                                    <option value="keyword">üìù Palabras Clave - B√∫squeda Tradicional</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">H√≠brida ofrece 89.2% de precisi√≥n</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-sliders-h mr-1 text-indigo-600"></i> Sensibilidad (Threshold): <span id="measureThresholdVal" class="text-indigo-600 font-bold">15</span>
                                </label>
                                <input type="range" 
                                       name="measure_threshold" 
                                       min="5" 
                                       max="50" 
                                       value="15" 
                                       class="w-full h-2 bg-gradient-to-r from-green-200 via-yellow-200 to-red-200 rounded-lg appearance-none cursor-pointer"
                                       oninput="document.getElementById('measureThresholdVal').textContent = this.value">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>M√°s inclusivo (5)</span>
                                    <span>Equilibrado (15)</span>
                                    <span>M√°s selectivo (50)</span>
                                </div>
                            </div>
                        </div>
                    </details>
                </form>

                <div class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    {% for measure in monitored_measures %}
                    <div class="bg-white p-4 rounded-lg border-2 border-indigo-200 hover:border-indigo-400 hover:shadow-md transition-all">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <span class="font-bold text-lg text-gray-800 font-mono">{{ measure.sutra_id }}</span>
                                {% if measure.keywords %}
                                <div class="mt-2 flex items-center gap-2">
                                    <i class="fas fa-search text-gray-400 text-xs"></i>
                                    <p class="text-sm text-gray-600 italic">{{ measure.keywords|truncatewords:15 }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <a href="{% url 'delete_item' 'measure' measure.id %}" 
                               class="text-gray-300 hover:text-red-500 transition-colors p-2 rounded-lg hover:bg-red-50"
                               title="Eliminar medida">
                                <i class="fas fa-trash-alt text-lg"></i>
                            </a>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <span class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-sliders-h mr-1"></i>Threshold: {{ measure.threshold }}
                            </span>
                            {% if measure.search_method == "hybrid" %}
                            <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-filter mr-1"></i>H√≠brida
                            </span>
                            {% elif measure.search_method == "semantic" %}
                            <span class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-brain mr-1"></i>Sem√°ntica
                            </span>
                            {% else %}
                            <span class="text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-font mr-1"></i>Palabras
                            </span>
                            {% endif %}
                            <span class="text-xs {% if measure.is_active %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-500{% endif %} px-3 py-1 rounded-full font-bold">
                                {% if measure.is_active %}
                                <i class="fas fa-check-circle mr-1"></i>Activa
                                {% else %}
                                <i class="fas fa-times-circle mr-1"></i>Inactiva
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-12 bg-white rounded-lg border-2 border-dashed border-indigo-200">
                        <i class="fas fa-inbox text-5xl text-indigo-200 mb-3"></i>
                        <p class="text-gray-600 font-semibold">No hay medidas monitoreadas</p>
                        <p class="text-sm text-gray-400 mt-1">Agrega tu primera medida legislativa arriba</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Panel: Comisiones Monitoreadas -->
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-6 border-2 border-purple-200">
                <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-users mr-2 text-purple-600 text-2xl"></i>
                    <span>Comisiones Legislativas</span>
                    <span class="ml-auto text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-semibold">{{ monitored_commissions|length }}</span>
                </h4>

                <p class="text-sm text-gray-600 mb-4">Rastrea todas las medidas de una comisi√≥n completa autom√°ticamente.</p>

                <form method="POST" class="mb-6">
                    {% csrf_token %}
                    <div class="flex gap-2 mb-4">
                        <input type="text" 
                               name="commission_name" 
                               placeholder="Ej: Comisi√≥n de Educaci√≥n" 
                               class="flex-1 p-3 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                               required>
                        <button type="submit" 
                                name="add_commission"
                                class="bg-purple-600 hover:bg-purple-700 text-white font-bold px-6 py-3 rounded-lg transition-all shadow-md hover:shadow-lg whitespace-nowrap">
                            <i class="fas fa-plus mr-2"></i> Agregar
                        </button>
                    </div>

                    <!-- Opciones avanzadas -->
                    <details class="bg-white rounded-lg border border-purple-200 overflow-hidden">
                        <summary class="cursor-pointer text-sm text-purple-700 hover:bg-purple-50 font-semibold p-3 select-none">
                            <i class="fas fa-cog mr-2"></i> Opciones Avanzadas (Opcional)
                        </summary>
                        <div class="p-4 space-y-4 bg-purple-50/50">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-search mr-1 text-purple-600"></i> Palabras Clave
                                </label>
                                <input type="text" 
                                       name="commission_keywords" 
                                       placeholder="educaci√≥n, presupuesto, reforma, salud..."
                                       class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                                <p class="text-xs text-gray-500 mt-1">Filtra medidas de esta comisi√≥n por t√©rminos espec√≠ficos</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-brain mr-1 text-purple-600"></i> M√©todo de B√∫squeda
                                </label>
                                <select name="commission_search_method" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                                    <option value="hybrid">üîÑ H√≠brida - Combina IA + Palabras (Recomendado)</option>
                                    <option value="semantic">üß† Sem√°ntica - Solo Inteligencia Artificial</option>
                                    <option value="keyword">üìù Palabras Clave - B√∫squeda Tradicional</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">H√≠brida ofrece 89.2% de precisi√≥n</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    <i class="fas fa-sliders-h mr-1 text-purple-600"></i> Sensibilidad (Threshold): <span id="commissionThresholdVal" class="text-purple-600 font-bold">15</span>
                                </label>
                                <input type="range" 
                                       name="commission_threshold" 
                                       min="5" 
                                       max="50" 
                                       value="15" 
                                       class="w-full h-2 bg-gradient-to-r from-green-200 via-yellow-200 to-red-200 rounded-lg appearance-none cursor-pointer"
                                       oninput="document.getElementById('commissionThresholdVal').textContent = this.value">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>M√°s inclusivo (5)</span>
                                    <span>Equilibrado (15)</span>
                                    <span>M√°s selectivo (50)</span>
                                </div>
                            </div>
                        </div>
                    </details>
                </form>

                <div class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    {% for commission in monitored_commissions %}
                    <div class="bg-white p-4 rounded-lg border-2 border-purple-200 hover:border-purple-400 hover:shadow-md transition-all">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <span class="font-bold text-lg text-gray-800">{{ commission.name }}</span>
                                {% if commission.keywords %}
                                <div class="mt-2 flex items-center gap-2">
                                    <i class="fas fa-search text-gray-400 text-xs"></i>
                                    <p class="text-sm text-gray-600 italic">{{ commission.keywords|truncatewords:15 }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <a href="{% url 'delete_item' 'commission' commission.id %}" 
                               class="text-gray-300 hover:text-red-500 transition-colors p-2 rounded-lg hover:bg-red-50"
                               title="Eliminar comisi√≥n">
                                <i class="fas fa-trash-alt text-lg"></i>
                            </a>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-sliders-h mr-1"></i>Threshold: {{ commission.threshold }}
                            </span>
                            {% if commission.search_method == "hybrid" %}
                            <span class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-filter mr-1"></i>H√≠brida
                            </span>
                            {% elif commission.search_method == "semantic" %}
                            <span class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-brain mr-1"></i>Sem√°ntica
                            </span>
                            {% else %}
                            <span class="text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-bold">
                                <i class="fas fa-font mr-1"></i>Palabras
                            </span>
                            {% endif %}
                            <span class="text-xs {% if commission.is_active %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-500{% endif %} px-3 py-1 rounded-full font-bold">
                                {% if commission.is_active %}
                                <i class="fas fa-check-circle mr-1"></i>Activa
                                {% else %}
                                <i class="fas fa-times-circle mr-1"></i>Inactiva
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-12 bg-white rounded-lg border-2 border-dashed border-purple-200">
                        <i class="fas fa-inbox text-5xl text-purple-200 mb-3"></i>
                        <p class="text-gray-600 font-semibold">No hay comisiones monitoreadas</p>
                        <p class="text-sm text-gray-400 mt-1">Agrega tu primera comisi√≥n legislativa arriba</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Info Box Final -->
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-l-4 border-indigo-500 p-6 rounded-r-lg shadow-sm">
            <h4 class="font-bold text-gray-800 mb-3 flex items-center text-lg">
                <i class="fas fa-lightbulb text-yellow-500 mr-3 text-xl"></i> 
                Consejos para un monitoreo efectivo
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                <div>
                    <h5 class="font-semibold text-indigo-700 mb-2"><i class="fas fa-file-alt mr-2"></i>Medidas Legislativas:</h5>
                    <ul class="space-y-1 pl-5">
                        <li>‚Ä¢ Ideal para seguimiento espec√≠fico de proyectos</li>
                        <li>‚Ä¢ Usa formato exacto: "P. de la C. 1234"</li>
                        <li>‚Ä¢ Agrega keywords para filtrar actualizaciones</li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-semibold text-purple-700 mb-2"><i class="fas fa-users mr-2"></i>Comisiones Legislativas:</h5>
                    <ul class="space-y-1 pl-5">
                        <li>‚Ä¢ Monitorea todas las medidas de una comisi√≥n</li>
                        <li>‚Ä¢ √ötil para temas amplios (educaci√≥n, salud, etc.)</li>
                        <li>‚Ä¢ Filtra por keywords para precisi√≥n</li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-semibold text-blue-700 mb-2"><i class="fas fa-brain mr-2"></i>M√©todos de B√∫squeda:</h5>
                    <ul class="space-y-1 pl-5">
                        <li>‚Ä¢ <strong>H√≠brida:</strong> Mejor precisi√≥n (89.2%)</li>
                        <li>‚Ä¢ <strong>Sem√°ntica:</strong> Encuentra contexto similar</li>
                        <li>‚Ä¢ <strong>Palabras:</strong> M√°s r√°pido y directo</li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-semibold text-green-700 mb-2"><i class="fas fa-sliders-h mr-2"></i>Threshold (Sensibilidad):</h5>
                    <ul class="space-y-1 pl-5">
                        <li>‚Ä¢ <strong>5-10:</strong> Captura todo lo posible</li>
                        <li>‚Ä¢ <strong>15-25:</strong> Equilibrado (recomendado)</li>
                        <li>‚Ä¢ <strong>30-50:</strong> Solo muy relevante</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Slider personalizado */
input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.4);
    transition: all 0.2s;
}

input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.6);
}

input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    border-radius: 50%;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.4);
    transition: all 0.2s;
}

input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.6);
}

/* Custom scrollbar */
.overflow-y-auto::-webkit-scrollbar {
    width: 8px;
}

.overflow-y-auto::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}
</style>

<script>
// Smooth scroll para detalles expandidos
document.querySelectorAll('details').forEach(detail => {
    detail.addEventListener('toggle', function() {
        if (this.open) {
            setTimeout(() => {
                this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }
    });
});
</script>
{% endblock %}
